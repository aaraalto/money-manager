:root {
    --font-mono: 'SF Mono', 'Monaco', 'Inconsolata', 'Roboto Mono', 'Courier New', monospace;

    /* Animation Timing */
    --ease-smooth: cubic-bezier(0.4, 0.0, 0.2, 1);
    --ease-bounce: cubic-bezier(0.68, -0.55, 0.265, 1.55);
    --ease-out: cubic-bezier(0.0, 0.0, 0.2, 1);

    /* Enforce Spacious Density by Default */
    --density-card-gap: var(--space-8);
    --density-card-padding: var(--space-8);
    --density-kpi-value-size: clamp(2.5rem, 6vw, 3.5rem); /* Increased Scaling */
    --density-stat-value-size: 1.75rem;
    --density-spacing: var(--space-10);
    
    /* Sidebar Variables */
    --sidebar-width: 260px;
    --sidebar-bg: #1a1a1a;
    --sidebar-border: 1px solid var(--border-default);
}

body {
    font-family: var(--font-body);
    background: var(--bg-body);
    color: var(--text-primary);
    margin: 0;
    padding: 0; /* Layout handles padding */
    line-height: 1.6;
    -webkit-font-smoothing: antialiased;
    height: 100vh;
    overflow: hidden; /* Scroll within main-content */
}

/* --- App Layout (Linear Style) --- */

.app-layout {
    display: flex;
    height: 100vh;
    width: 100%;
    overflow: hidden;
}

/* Sidebar */
.app-sidebar {
    width: var(--sidebar-width);
    background: var(--sidebar-bg);
    border-right: var(--sidebar-border);
    display: flex;
    flex-direction: column;
    flex-shrink: 0;
    padding: var(--space-6);
    transition: transform 0.3s var(--ease-smooth);
}

.sidebar-header {
    margin-bottom: var(--space-8);
}

.brand-logo {
    display: flex;
    align-items: center;
    gap: var(--space-3);
    font-family: var(--font-heading);
    font-weight: 700;
    font-size: 1.25rem;
    color: var(--text-primary);
}

.brand-name {
    background: linear-gradient(135deg, #fff 0%, #a5b4fc 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
}

.sidebar-nav {
    display: flex;
    flex-direction: column;
    gap: var(--space-1);
    flex: 1;
}

.nav-item {
    display: flex;
    align-items: center;
    gap: var(--space-3);
    padding: var(--space-2) var(--space-3);
    color: var(--text-secondary);
    text-decoration: none;
    font-size: 0.9rem;
    font-weight: 500;
    border-radius: var(--radius-sm);
    transition: all 0.2s ease;
}

.nav-item:hover {
    color: var(--text-primary);
    background: var(--bg-subtle);
}

.nav-item.active {
    color: var(--text-primary);
    background: var(--bg-subtle);
    font-weight: 600;
}

.nav-item svg {
    opacity: 0.7;
}

.nav-item.active svg {
    opacity: 1;
    color: var(--brand-primary);
}

.sidebar-footer {
    margin-top: auto;
    padding-top: var(--space-4);
    border-top: 1px solid var(--border-subtle);
}

.user-profile {
    display: flex;
    align-items: center;
    gap: var(--space-3);
    padding: var(--space-2);
    border-radius: var(--radius-md);
    transition: background 0.2s ease;
    cursor: pointer;
}

.user-profile:hover {
    background: var(--bg-subtle);
}

.avatar {
    width: 32px;
    height: 32px;
    background: var(--bg-card);
    border: 1px solid var(--border-color);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    color: var(--text-secondary);
}

.user-info {
    display: flex;
    flex-direction: column;
}

.user-name {
    font-size: 0.85rem;
    font-weight: 500;
    color: var(--text-primary);
}

.user-level {
    font-size: 0.75rem;
    color: var(--text-tertiary);
}

/* Main Content Area */
.main-content {
    flex: 1;
    overflow-y: auto;
    padding: var(--space-6) var(--space-8);
    background: var(--bg-body);
}

.container {
    max-width: 1200px;
    margin: 0 auto;
    width: 100%;
    padding: 0;
}

/* Mobile Nav */
@media (max-width: 768px) {
    .app-layout {
        flex-direction: column;
    }
    
    .app-sidebar {
        width: 100%;
        height: auto;
        flex-direction: row;
        align-items: center;
        justify-content: space-between;
        padding: var(--space-4);
        border-right: none;
        border-bottom: var(--sidebar-border);
    }

    .sidebar-nav {
        flex-direction: row;
        flex: 0;
    }
    
    .nav-item span {
        display: none;
    }
    
    .sidebar-footer {
        display: none;
    }
    
    .sidebar-header {
        margin-bottom: 0;
    }

    .main-content {
        padding: var(--space-6);
    }
}

/* --- Header (Page Titles) --- */
.app-header {
    margin-bottom: var(--space-8);
    /* animation: fadeInDown 0.6s var(--ease-smooth); Handled by GSAP */
    display: flex;
    justify-content: space-between;
    align-items: flex-end;
    position: relative; /* Create positioning context */
    z-index: 100; /* Ensure header is above other content */
    overflow: visible; /* Allow dropdown to overflow */
    opacity: 0; /* Default hidden for GSAP to reveal */
}

/* Balanced Grid Header Layout */
.app-header-balanced {
    display: grid;
    grid-template-columns: 1fr auto 1fr;
    align-items: center;
    gap: var(--space-8); /* Increased gap */
    width: 100%;
    padding: 0 var(--space-4); /* Added horizontal padding */
    box-sizing: border-box; /* Ensure padding doesn't overflow width */
}

.app-header-balanced .header-brand {
    justify-self: start;
    align-items: center;
    flex-direction: row; /* Horizontal brand lockup */
}

.app-header-balanced .header-center {
    justify-self: center;
    text-align: center;
}

.app-header-balanced .header-controls {
    justify-self: end;
}

@keyframes fadeInDown {
    from {
        opacity: 0;
        transform: translateY(-10px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.header-brand {
    display: flex;
    flex-direction: column; /* Default stack */
    gap: var(--space-4);
    position: relative; /* Ensure context for absolute children if needed */
    z-index: 101;
}

.brand-lockup {
    display: flex;
    align-items: center;
    gap: var(--space-4);
}

.header-brand h1 {
    font-family: var(--font-heading);
    font-weight: 700;
    font-size: 2rem;
    margin: 0;
    letter-spacing: -0.02em;
    color: var(--text-primary);
    display: flex;
    align-items: center;
    gap: var(--space-4);
    line-height: 1;
}

.header-brand .tagline {
    color: var(--text-secondary);
    font-size: 1rem;
    margin-top: var(--space-1);
    margin-bottom: 0;
    font-weight: 400;
}

.header-controls {
    display: flex;
    gap: var(--space-3);
    align-items: center;
}

.btn-nav {
    text-decoration: none;
    color: var(--text-primary);
    font-weight: 500;
    padding: var(--space-2) var(--space-4);
    border-radius: var(--radius-md);
    background: var(--bg-card);
    border: 1px solid var(--border-color);
    box-shadow: var(--shadow-sm);
    transition: all 0.2s var(--ease-smooth);
    display: inline-flex;
    align-items: center;
    gap: var(--space-2);
    font-size: 0.9rem;
}

.btn-nav:hover {
    transform: translateY(-1px);
    background: var(--bg-card-hover);
    border-color: var(--border-default);
    color: var(--text-primary);
}

/* Cards */
.card {
    background: var(--bg-card);
    border-radius: var(--radius-lg);
    padding: var(--density-card-padding);
    margin-bottom: var(--space-6);
    box-shadow: var(--shadow-sm); /* Subtler shadow for Linear look */
    border: 1px solid var(--border-color);
    transition: all 0.3s var(--ease-smooth);
}

.card:hover {
    transform: translateY(-2px);
    box-shadow: var(--shadow-md);
    background: var(--bg-card-hover);
    border-color: var(--border-subtle);
}

.card h2 {
    font-family: var(--font-heading);
    font-size: 1.125rem; /* 18px - matches design system H2 */
    color: var(--text-primary);
    margin-top: 0;
    margin-bottom: var(--space-6);
    display: flex;
    align-items: center;
    gap: var(--space-3);
    font-weight: 600;
    position: relative;
    letter-spacing: -0.01em;
}

.card h2 svg {
    color: var(--text-secondary);
    opacity: 0.7;
    width: 20px;
    height: 20px;
}

/* Grid Layout */
.grid {
    display: grid;
    grid-template-columns: 1fr;
    gap: var(--density-card-gap);
}

@media (min-width: 768px) {
    .grid {
        grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
    }
}

/* Dashboard Overview Section */
.dashboard-overview {
    display: grid;
    grid-template-columns: 1fr;
    gap: var(--density-card-gap);
    margin-bottom: var(--density-spacing);
    /* align-items: start; Removed to allow cards to stretch to matching heights */
}

.dashboard-overview .card {
    display: flex;
    flex-direction: column;
    height: 100%;
}

/* De-emphasize section titles in overview */
.dashboard-overview .card h2 {
    color: var(--text-tertiary);
    font-size: 0.85rem;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    font-weight: 600;
    opacity: 0.8;
}

@media (min-width: 1024px) {
    .dashboard-overview {
        grid-template-columns: 1fr 2fr; /* Swapped ratio for Daily Safe-to-Spend focus if needed, or keep 1:1 or 2:1 */
        /* Let's try balanced or 1:2 if chart is complex. Previous was 2:1 for chart. 
           Since "Daily Capacity" is now primary, let's make them more balanced or keep chart big. 
           User asked for "Daily Spend first", so it's column 1. 
           If Daily Spend is compact, maybe 1:2 is better. 
           Let's stick to 1:2 (Daily : Chart) or 1:1. 
           Given content, 1:2 is good. */
        grid-template-columns: 1fr 2fr; 
        min-height: 300px;
    }
}

.chart-container {
    width: 100%;
    height: 100%; /* Fill parent card body */
    min-height: 220px; /* Default minimum */
    position: relative;
    background: transparent;
    border-radius: 0;
    padding: 0;
    margin-bottom: 0;
    border: none;
    overflow: visible;
    display: flex;
    justify-content: center;
    align-items: center;
}

.chart-container svg {
    max-width: 100%;
    height: 100%;
}

/* Reasoning / Context */
.reasoning {
    background: var(--bg-subtle);
    padding: var(--space-5);
    border-radius: var(--radius-md);
    font-family: var(--font-mono);
    font-size: 0.85rem;
    color: var(--text-secondary);
    margin-top: 0;
    border-left: 2px solid var(--primary);
    line-height: 1.6;
    border: 1px solid var(--border-color);
    border-left-width: 2px;
}

/* Stat Card */
.stat {
    display: flex;
    flex-direction: column;
    gap: var(--space-1);
}

.stat-label {
    font-size: 0.75rem;
    color: var(--text-tertiary);
    font-weight: 600;
    text-transform: uppercase;
}

.stat-value {
    font-size: var(--density-stat-value-size); /* 1.75rem from design system */
    font-weight: 600;
    font-family: var(--font-mono);
    color: var(--text-primary);
}

/* Loading State */
#loading {
    text-align: center;
    padding: var(--space-8);
    font-size: 0.9rem;
    color: var(--text-tertiary);
    animation: pulse 2s infinite;
}

@keyframes pulse {
    0% { opacity: 0.6; }
    50% { opacity: 1; }
    100% { opacity: 0.6; }
}

/* Utility Classes */
.hidden { display: none !important; }

.text-gradient {
    background: linear-gradient(135deg, var(--primary), #a5b4fc);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
}

.text-success { color: var(--success); }
.text-danger { color: var(--danger); }
.text-warning { color: var(--warning); }
.text-primary-color { color: var(--primary); }

/* Scrollbar Styling */
::-webkit-scrollbar {
    width: 8px;
    height: 8px;
}

::-webkit-scrollbar-track {
    background: transparent;
}

::-webkit-scrollbar-thumb {
    background: #333;
    border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
    background: #444;
}

/* Selection Styling */
::selection {
    background: rgba(91, 141, 232, 0.2);
    color: #fff;
}

/* Card Overlay System - Keep existing functionality but refine style */
.card-overlay {
    background: rgba(0, 0, 0, 0.8);
    backdrop-filter: blur(4px);
}

.overlay-header {
    background: #1a1a1a;
    border-bottom: 1px solid var(--border-color);
}

/* --- Hero Allowance Section (Level 1 Focus) --- */
.hero-allowance-container {
    position: relative;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: var(--space-12) var(--space-6);
    margin-bottom: var(--space-8);
    border-radius: var(--radius-xl);
    background: linear-gradient(180deg, rgba(255,255,255,0.03) 0%, rgba(255,255,255,0) 100%), #0f1014;
    border: 1px solid rgba(255, 255, 255, 0.08);
    box-shadow: 
        0 0 0 1px rgba(0,0,0,0.2),
        0 20px 40px -10px rgba(0,0,0,0.5);
    overflow: hidden;
    transition: transform 0.4s cubic-bezier(0.2, 0.8, 0.2, 1), box-shadow 0.4s cubic-bezier(0.2, 0.8, 0.2, 1);
}

.hero-allowance-container:hover {
    transform: translateY(-2px);
    box-shadow: 
        0 0 0 1px rgba(255,255,255,0.1),
        0 30px 60px -12px rgba(0,0,0,0.6);
}

.hero-content {
    text-align: center;
    z-index: 2;
    width: 100%;
}

.hero-label {
    font-family: var(--font-heading);
    font-size: 0.85rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.1em;
    color: var(--text-tertiary);
    margin-bottom: var(--space-2);
}

.hero-value-row {
    display: flex;
    align-items: flex-start;
    justify-content: center;
    line-height: 1;
    margin-bottom: var(--space-6);
    position: relative;
}

.hero-allowance-value {
    font-family: var(--font-mono);
    font-size: clamp(3.5rem, 10vw, 6rem);
    font-weight: 700;
    color: var(--success);
    letter-spacing: -0.03em;
    background: linear-gradient(135deg, #fff 30%, var(--success) 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    filter: drop-shadow(0 0 30px rgba(74, 222, 128, 0.15));
}

.hero-allowance-sub {
    font-size: 1rem;
    color: var(--text-secondary);
    max-width: 400px;
    margin: 0 auto var(--space-8);
    line-height: 1.5;
    font-weight: 400;
}

/* System Integrity Panel */
.system-integrity-panel {
    display: flex;
    gap: var(--space-8);
    padding: var(--space-4) var(--space-8);
    background: rgba(255, 255, 255, 0.03);
    border-radius: 100px;
    border: 1px solid rgba(255, 255, 255, 0.05);
    backdrop-filter: blur(10px);
}

.integrity-item {
    display: flex;
    align-items: center;
    gap: var(--space-2);
    opacity: 0.4;
    transition: opacity 0.3s ease;
}

.integrity-item.active {
    opacity: 1;
}

.led-indicator {
    width: 6px;
    height: 6px;
    border-radius: 50%;
    background: #333;
    box-shadow: inset 0 1px 2px rgba(0,0,0,0.5);
    transition: all 0.3s ease;
}

.integrity-item.active .led-indicator {
    background: #10b981; /* Emerald 500 */
    box-shadow: 0 0 8px rgba(16, 185, 129, 0.8);
}

.integrity-label {
    font-size: 0.75rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    color: var(--text-tertiary);
    transition: color 0.3s ease;
}

.integrity-item.active .integrity-label {
    color: var(--text-primary);
}

/* Hide old style status items if any remain */
.status-line { display: none; }

/* War Room Header */
.section-header {
    margin-bottom: var(--space-6);
    border-bottom: 1px solid var(--border-subtle);
    padding-bottom: var(--space-2);
    display: flex;
    justify-content: space-between;
    align-items: flex-end;
}

.section-header h3 {
    margin: 0;
    font-family: var(--font-heading);
    font-size: 1.25rem;
    color: var(--text-secondary);
}

.section-header p {
    margin: 0;
    font-size: 0.85rem;
    color: var(--text-tertiary);
}

/* Animation Utilities */
.fade-in-up {
    opacity: 0;
    transform: translateY(10px);
    animation: fadeInUp 0.6s forwards ease-out;
}

.delay-1 { animation-delay: 0.1s; }
.delay-2 { animation-delay: 0.2s; }
.delay-3 { animation-delay: 0.3s; }

@keyframes fadeInUp {
    to { opacity: 1; transform: translateY(0); }
}

/* Net Worth Growth Component */
.growth-container {
    display: flex;
    flex-direction: column;
    gap: var(--space-6);
}

.growth-main {
    display: flex;
    flex-direction: column;
    gap: var(--space-1);
}

.label-subtle {
    font-size: 0.85rem;
    color: var(--text-tertiary);
    font-weight: 500;
    text-transform: uppercase;
    letter-spacing: 0.05em;
}

.value-hero {
    font-size: 2.5rem;
    font-weight: 700;
    font-family: var(--font-mono);
    color: var(--text-primary);
    letter-spacing: -1px;
    line-height: 1;
}

.growth-details {
    display: flex;
    align-items: center;
    gap: var(--space-6);
    padding-top: var(--space-4);
    border-top: 1px solid var(--border-subtle);
}

.detail-item {
    display: flex;
    flex-direction: column;
    gap: var(--space-1);
}

.detail-label {
    font-size: 0.75rem;
    color: var(--text-tertiary);
    font-weight: 500;
}

.detail-value {
    font-size: 1.1rem;
    font-weight: 600;
    font-family: var(--font-mono);
    color: var(--text-primary);
}

.detail-divider {
    width: 1px;
    height: 30px;
    background: var(--border-subtle);
}

/* Level Pill */
.level-pill {
    display: flex;
    align-items: center;
    gap: var(--space-2);
    padding: 6px 16px;
    border-radius: 100px;
    font-size: 0.8rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    cursor: pointer;
    border: 1px solid transparent;
    transition: all 0.2s ease;
    background: var(--bg-subtle);
    color: var(--text-secondary);
}

.level-pill:hover {
    background: var(--bg-card-hover);
    border-color: var(--border-subtle);
    transform: translateY(-1px);
}

.level-pill svg {
    opacity: 0.6;
    transition: transform 0.2s ease;
}

.level-pill:hover svg {
    transform: rotate(180deg);
}

/* Badge Colors for Pill */
.level-pill.badge-info { background: rgba(99, 102, 241, 0.1); color: var(--primary); border: 1px solid rgba(99, 102, 241, 0.2); }
.level-pill.badge-success { background: rgba(16, 185, 129, 0.1); color: var(--success); border: 1px solid rgba(16, 185, 129, 0.2); }
.level-pill.badge-warning { background: rgba(245, 158, 11, 0.1); color: var(--warning); border: 1px solid rgba(245, 158, 11, 0.2); }
.level-pill.badge-primary { background: var(--primary); color: white; }

/* --- Wealth Levels Modal (Redesigned) --- */

.wealth-modal {
    border: 1px solid var(--border-subtle);
    border-radius: var(--radius-xl);
    background: #0f1014; /* Deep dark background */
    padding: 0;
    box-shadow: 
        0 0 0 1px rgba(255, 255, 255, 0.05),
        0 20px 60px rgba(0, 0, 0, 0.6),
        0 0 120px rgba(99, 102, 241, 0.1); /* Subtle ambient glow */
    max-width: 540px;
    width: 90%;
    color: var(--text-primary);
    overflow: hidden;
    transform: scale(0.95);
    opacity: 0;
    transition: opacity 0.3s ease, transform 0.3s cubic-bezier(0.2, 0.8, 0.2, 1);
}

.wealth-modal[open] {
    transform: scale(1);
    opacity: 1;
}

.wealth-modal::backdrop {
    background: rgba(5, 5, 10, 0.85); /* Slightly darker */
    backdrop-filter: blur(16px); /* More blur */
    -webkit-backdrop-filter: blur(16px);
    transition: all 0.3s ease;
}

.wealth-modal .modal-content {
    padding: 0;
}

.wealth-modal .modal-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    padding: var(--space-8) var(--space-10); /* Increased Padding */
    background: linear-gradient(to bottom, rgba(255, 255, 255, 0.03), rgba(255, 255, 255, 0));
    border-bottom: 1px solid var(--border-subtle);
}

.wealth-modal .header-title h2 {
    font-family: var(--font-heading);
    font-size: 1.75rem; /* Larger title */
    font-weight: 700;
    margin: 0;
    background: linear-gradient(to right, #fff, #94a3b8);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    letter-spacing: -0.02em;
}

.wealth-modal .subtitle {
    margin: var(--space-2) 0 0 0;
    font-size: 0.95rem;
    color: var(--text-tertiary);
    font-weight: 400;
}

.wealth-modal .close-btn {
    background: transparent;
    border: none;
    color: var(--text-tertiary);
    padding: var(--space-2);
    border-radius: var(--radius-sm);
    cursor: pointer;
    transition: all 0.2s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    opacity: 0.7;
}

.wealth-modal .close-btn:hover {
    color: var(--text-primary);
    background: rgba(255, 255, 255, 0.05);
    opacity: 1;
}

/* Ladder Layout */
.wealth-ladder {
    padding: var(--space-10) var(--space-10); /* Increased Padding */
    display: flex;
    flex-direction: column;
    gap: 0;
    position: relative;
}

.ladder-step {
    display: flex;
    gap: var(--space-6); /* More gap between marker and text */
    position: relative;
    padding-bottom: var(--space-10); /* More vertical breathing room */
}

.ladder-step:last-child {
    padding-bottom: 0;
}

/* Step Marker System */
.step-marker {
    display: flex;
    flex-direction: column;
    align-items: center;
    width: 36px; /* Slightly larger markers */
    flex-shrink: 0;
}

.marker-node {
    width: 36px;
    height: 36px;
    border-radius: 50%;
    background: #131316; /* Darker background for "Future" */
    border: 2px solid #2a2a30; /* Darker border for "Future" */
    color: #444; /* Dimmed text for "Future" */
    display: flex;
    align-items: center;
    justify-content: center;
    font-family: var(--font-mono);
    font-size: 0.9rem;
    font-weight: 600;
    z-index: 2;
    transition: all 0.3s cubic-bezier(0.2, 0.8, 0.2, 1);
    position: relative; /* For pseudo-elements */
}

/* Dashed Line for Future Steps (Default) */
.marker-line {
    flex: 1;
    width: 2px;
    background: repeating-linear-gradient(
        to bottom,
        #2a2a30 0,
        #2a2a30 4px,
        transparent 4px,
        transparent 8px
    ); /* Dashed line */
    min-height: 24px;
    margin-top: -2px;
    margin-bottom: -2px;
    z-index: 1;
    transition: all 0.3s ease;
    opacity: 0.5;
}

/* Remove line for last item */
.ladder-step:last-child .marker-line {
    display: none;
}

/* Content Styling (Future Default) */
.step-content {
    flex: 1;
    padding-top: 2px;
    opacity: 0.4; /* Dimmed for Future */
    transition: opacity 0.3s ease;
}

.step-header {
    display: flex;
    align-items: center;
    gap: var(--space-3);
    margin-bottom: var(--space-2);
}

.step-header h3 {
    margin: 0;
    font-size: 1.1rem;
    font-weight: 600;
    color: var(--text-primary);
}

.step-tag {
    font-size: 0.7rem;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    font-weight: 600;
    padding: 3px 10px;
    border-radius: 100px;
    background: rgba(255, 255, 255, 0.05);
    color: var(--text-tertiary);
    border: 1px solid rgba(255, 255, 255, 0.05);
}

.step-content p {
    margin: 0;
    font-size: 0.95rem;
    color: var(--text-secondary);
    line-height: 1.6;
}

/* --- Interactive States (The Logic) --- */

/* Hover on Future Steps */
.ladder-step:not(.active):hover .marker-node {
    border-color: #444;
    color: #888;
    background: #1a1a1a;
}

.ladder-step:not(.active):hover .step-content {
    opacity: 0.7;
}

/* Animation for the Electric Beam */
@keyframes electric-ascend {
    0% { background-position: 0% 100%; }
    100% { background-position: 0% 0%; }
}

/* 1. ACTIVE STATE (Current Level) */
.ladder-step.active .marker-node {
    background: var(--primary);
    border-color: var(--primary);
    color: white;
    box-shadow: 
        0 0 0 4px rgba(99, 102, 241, 0.15),
        0 0 30px rgba(99, 102, 241, 0.5);
    transform: scale(1.15);
}

/* 
   UPDATE: The Active Line (Connecting Active -> Past) 
   This creates the "Shock" effect
*/
.ladder-step.active .marker-line {
    /* The Beam Gradient: Dark -> Primary -> White Hot -> Primary -> Dark */
    background: linear-gradient(
        to top, 
        var(--primary) 0%, 
        #6366f1 40%, 
        #ffffff 50%, 
        #6366f1 60%, 
        var(--primary) 100%
    );
    
    /* Scale the background so the "beam" is only a small part of the total height */
    background-size: 100% 300%; 
    
    /* The Animation: 2s cycle, infinite loop */
    animation: electric-ascend 2s linear infinite;
    
    /* Add a glow to the line itself */
    box-shadow: 0 0 15px rgba(99, 102, 241, 0.6);
    opacity: 1;
    
    /* Ensure it stays distinct */
    z-index: 5;
}

.ladder-step.active .step-content {
    opacity: 1;
}

.ladder-step.active .step-header h3 {
    color: white;
    text-shadow: 0 0 20px rgba(255, 255, 255, 0.2);
}

.ladder-step.active .step-tag {
    background: rgba(99, 102, 241, 0.2);
    color: #a5b4fc;
    border: 1px solid rgba(99, 102, 241, 0.3);
    box-shadow: 0 0 10px rgba(99, 102, 241, 0.1);
}

/* 2. COMPLETED STATES (Levels Below Active) 
   Since HTML order is 5 -> 1, the siblings AFTER active are lower levels (1, 2...).
   We want these to look solid and foundational.
*/

.ladder-step.active ~ .ladder-step .marker-node {
    background: #1e293b; /* Solid, settled slate */
    border-color: #475569;
    color: #94a3b8;
    box-shadow: none;
}

/* Completed Levels (Solid Foundation) */
.ladder-step.active ~ .ladder-step .marker-line {
    /* A steady flow, less intense */
    background: linear-gradient(
        to top, 
        #334155 0%, 
        #475569 50%, 
        #334155 100%
    );
    background-size: 100% 200%;
    animation: electric-ascend 4s linear infinite; /* Slower flow */
    opacity: 1;
}

.ladder-step.active ~ .ladder-step .step-content {
    opacity: 0.6; /* Visible but not focus */
}

.ladder-step.active ~ .ladder-step .step-tag {
    background: rgba(16, 185, 129, 0.1); /* Subtle green hint for done */
    color: #34d399;
    border-color: rgba(16, 185, 129, 0.1);
}

/* Hover on Completed Steps */
.ladder-step.active ~ .ladder-step:hover .step-content {
    opacity: 0.9;
}

.ladder-step.active ~ .ladder-step:hover .marker-node {
    border-color: #94a3b8;
    color: #f1f5f9;
}

/* --- Daily Spend Card Styles (Refined) --- */

.daily-spend-container {
    display: flex;
    flex-direction: column;
    gap: var(--space-6);
    padding: var(--space-2);
}

.spend-header {
    text-align: center;
}

.spend-value-wrapper {
    display: flex;
    justify-content: center;
    align-items: flex-start;
    margin-top: var(--space-2);
    position: relative;
}

.spend-value {
    font-family: var(--font-mono);
    font-size: clamp(3.5rem, 6vw, 5rem);
    font-weight: 700;
    color: var(--success);
    line-height: 1;
    letter-spacing: -1px;
}

.spend-context {
    display: flex;
    align-items: center;
    gap: var(--space-4);
    opacity: 0.8;
}

.context-line {
    flex: 1;
    height: 1px;
    background: var(--border-subtle);
}

.context-text {
    font-size: 0.85rem;
    color: var(--text-secondary);
    text-align: center;
    line-height: 1.4;
    margin: 0;
}

.spend-metrics {
    display: flex;
    justify-content: space-between;
    background: var(--bg-subtle);
    border-radius: var(--radius-md);
    padding: var(--space-4);
    border: 1px solid var(--border-subtle);
}

.metric-item {
    display: flex;
    flex-direction: column;
    align-items: center;
    flex: 1;
}

.metric-divider {
    width: 1px;
    background: var(--border-subtle);
    margin: 0 var(--space-4);
}

.metric-label {
    font-size: 0.7rem;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    color: var(--text-tertiary);
    margin-bottom: var(--space-1);
    font-weight: 600;
}

.metric-value {
    font-family: var(--font-mono);
    font-size: 1.1rem;
    font-weight: 600;
    color: var(--text-primary);
}

.label-mono {
    font-family: var(--font-mono);
    font-size: 0.75rem;
    text-transform: uppercase;
    color: var(--text-tertiary);
    letter-spacing: 0.05em;
}
