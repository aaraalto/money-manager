{# frontend/partials/generative_content.html #}

{# 1. Metrics #}
<div id="metric-fcf" hx-swap-oob="true" class="kpi-value text-primary-color">{{ format_currency(data.cash_flow.free) }}</div>
<div id="metric-date" hx-swap-oob="true" class="kpi-value date">{{ data.debt_payoff.avalanche.date_free }}</div>
<div id="metric-savings" hx-swap-oob="true" class="kpi-value">{{ format_currency(data.debt_payoff.snowball.interest_paid - data.debt_payoff.avalanche.interest_paid) }}</div>

{# 2. Chart #}
<div id="chart-container" hx-swap-oob="true">
    {{ chart_svg | safe }}
</div>

{# 3. Payment Table #}
<div id="payment-table-container" hx-swap-oob="true" class="sim-table-container">
    <table class="sim-table">
        <thead>
            <tr>
                <th class="text-left">Liability</th>
                <th class="text-right">Balance</th>
                <th class="text-right">Rate</th>
                <th class="text-right">Min</th>
                <th class="text-right">Extra</th>
                <th class="text-right">Total</th>
            </tr>
        </thead>
        <tbody>
            {% for item in plan %}
            <tr class="sim-row {% if item.extraAllocation > 0 %}highlight-row{% endif %}">
                <td class="cell-name">
                    <div class="name-wrapper">
                        <span class="name-text">{{ item.name }}</span>
                        {% if item.extraAllocation > 0 %}
                        <span class="badge badge-pay">PAY THIS</span>
                        {% endif %}
                    </div>
                </td>
                <td class="text-right cell-mono">{{ format_currency(item.balance) }}</td>
                <td class="text-right cell-mono text-secondary">{{ "%.1f"|format(item.interest_rate * 100) }}%</td>
                <td class="text-right cell-mono">{{ format_currency(item.min_payment) }}</td>
                <td class="text-right cell-mono cell-extra">
                    {% if item.extraAllocation > 0 %}
                        <span class="text-success">+{{ format_currency(item.extraAllocation) }}</span>
                    {% else %}
                        <span class="text-muted">-</span>
                    {% endif %}
                </td>
                <td class="text-right cell-mono cell-total">{{ format_currency(item.pay) }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    
    <div class="table-footer">
        Visible Total: <span class="total-val">{{ format_currency(visible_total) }}</span>
    </div>
</div>

{# 4. Filters (Update active state) #}
<div id="filter-container" class="filter-row" hx-swap-oob="true">
    {% set tags = ['All', 'Credit Card', 'Personal Loans', 'Student Loans', 'Taxes'] %}
    {% for tag in tags %}
        <button 
            class="filter-btn {% if tag == filter_tag %}active{% endif %}"
            onclick="document.querySelector('input[name=filter_tag]').value='{{ tag }}'; htmx.trigger('#hidden-payment-input', 'change')"
        >
            {{ tag }}
        </button>
    {% endfor %}
</div>

{# 5. Insights (Initial Load) #}
{# We trigger a separate load for insights to keep this partial clean, or include the first one here. #}
{# Let's use hx-trigger to load the first insight if it's empty #}
<div id="insights-trigger" hx-get="/partials/insights?index=0" hx-target="#insights-wrapper" hx-trigger="load" hx-swap="innerHTML" style="display:none"></div>
