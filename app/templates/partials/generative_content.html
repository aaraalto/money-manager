{# frontend/partials/generative_content.html #}

{# 1. Metrics #}
<div id="metric-fcf" hx-swap-oob="true" class="kpi-value text-primary">{{ format_currency(data.cash_flow.free) }}</div>
<div id="metric-date" hx-swap-oob="true" class="kpi-value date">{{ data.debt_payoff.avalanche.date_free }}</div>
<div id="metric-savings" hx-swap-oob="true" class="kpi-value">{{ format_currency(data.debt_payoff.snowball.interest_paid - data.debt_payoff.avalanche.interest_paid) }}</div>

{# 2. Chart #}
<div id="chart-container" hx-swap-oob="true">
    {{ chart_svg | safe }}
</div>

{# 3. Payment Table #}
<div id="payment-table-container" hx-swap-oob="true" class="sim-table-container">
    {% if plan|length == 0 %}
    <div class="empty-state-wrapper">
        <div class="empty-icon">
            <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                <path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"></path>
                <line x1="9" y1="9" x2="9.01" y2="9"></line>
                <line x1="15" y1="9" x2="15.01" y2="9"></line>
                <path d="M8 13a5 5 0 0 0 4 0"></path>
                <polyline points="16 5 19 2 22 5"></polyline>
            </svg>
        </div>
        <h3>No Liabilities Found</h3>
        <p>Your financial table is clean. Add a liability to generate your payoff plan.</p>
        <button class="btn-quiet" onclick="document.querySelector('.rotary-container').scrollIntoView({behavior: 'smooth'})">
            Add Liability
        </button>
    </div>
    {% else %}
    <table class="sim-table">
        <thead>
            <tr>
                <th class="text-left">Liability</th>
                <th class="text-right">Balance</th>
                <th class="text-right">Rate</th>
                <th class="text-right">Min</th>
                <th class="text-right">Extra</th>
                <th class="text-right">Total</th>
            </tr>
        </thead>
        <tbody>
            {% for item in plan %}
            <tr class="sim-row {% if item.extraAllocation > 0 %}highlight-row{% endif %}">
                <td class="cell-name">
                    <div class="name-wrapper">
                        <span class="name-text">{{ item.name }}</span>
                        {% if item.extraAllocation > 0 %}
                        <span class="badge badge-pay">PAY THIS</span>
                        {% endif %}
                    </div>
                </td>
                <td class="text-right cell-mono">{{ format_currency(item.balance) }}</td>
                <td class="text-right">
                    <span class="badge badge-soft {% if item.interest_rate > 0.2 %}text-danger{% endif %}">
                        {{ "%.1f"|format(item.interest_rate * 100) }}%
                    </span>
                </td>
                <td class="text-right cell-mono">{{ format_currency(item.min_payment) }}</td>
                <td class="text-right cell-mono cell-extra">
                    {% if item.extraAllocation > 0 %}
                        <span class="text-success">+{{ format_currency(item.extraAllocation) }}</span>
                    {% else %}
                        <span class="text-muted">-</span>
                    {% endif %}
                </td>
                <td class="text-right cell-mono cell-total">{{ format_currency(item.pay) }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    
    <div class="table-footer">
        Visible Total: <span class="total-val">{{ format_currency(visible_total) }}</span>
    </div>
    {% endif %}
</div>

{# 4. Filters (Update active state) #}
<div id="filter-container" class="filter-row" hx-swap-oob="true">
    {% set tags = ['All', 'Credit Card', 'Personal Loans', 'Student Loans', 'Taxes'] %}
    {% for tag in tags %}
        <button 
            class="filter-btn {% if tag == filter_tag %}active{% endif %}"
            onclick="document.querySelector('input[name=filter_tag]').value='{{ tag }}'; htmx.trigger('#hidden-payment-input', 'change')"
        >
            {{ tag }}
        </button>
    {% endfor %}
</div>

{# 5. Insights (Initial Load) #}
{# We trigger a separate load for insights to keep this partial clean, or include the first one here. #}
{# Let's use hx-trigger to load the first insight if it's empty #}
<div id="insights-trigger" hx-get="/partials/insights?index=0" hx-target="#insights-wrapper" hx-trigger="load" hx-swap="innerHTML" style="display:none"></div>
