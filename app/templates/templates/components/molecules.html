{% from "templates/components/atoms.html" import icon, button %}

{# Card Component #}
{% macro card(title, icon_name=None, id=None, extra_classes="") %}
<div class="card {{ extra_classes }}" {% if id %}id="{{ id }}"{% endif %}>
    {% if title %}
    <h2>
        {% if icon_name %}
            {{ icon(icon_name) }}
        {% endif %}
        {{ title }}
    </h2>
    {% endif %}
    {{ caller() }}
</div>
{% endmacro %}

{# Alert Component #}
{% macro alert(title, description, variant="info", icon_name="info") %}
<div class="alert alert-{{ variant }}">
    <svg class="alert-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <circle cx="12" cy="12" r="10"></circle>
        <line x1="12" y1="16" x2="12" y2="12"></line>
        <line x1="12" y1="8" x2="12.01" y2="8"></line>
    </svg>
    <div class="alert-content">
        {% if title %}<div class="alert-title">{{ title }}</div>{% endif %}
        <div class="alert-description">{{ description }}</div>
    </div>
</div>
{% endmacro %}

{# Stat / KPI Component #}
{% macro stat(label, value="--", id=None, change=None, change_positive=True) %}
<div class="stat">
    <div class="stat-label">{{ label }}</div>
    <div class="stat-value" {% if id %}id="{{ id }}"{% endif %}>{{ value }}</div>
    {% if change %}
    <div class="stat-change {% if change_positive %}positive{% else %}negative{% endif %}">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <polyline points="18 15 12 9 6 15"></polyline>
        </svg>
        <span>{{ change }}</span>
    </div>
    {% endif %}
</div>
{% endmacro %}

{# KPI Box (Compact) #}
{% macro kpi_box(label, value="--", id=None) %}
<div class="kpi">
    <div class="kpi-label">{{ label }}</div>
    <div class="kpi-value" {% if id %}id="{{ id }}"{% endif %}>{{ value }}</div>
</div>
{% endmacro %}

{# Navigation Dropdown #}
{% macro nav_dropdown() %}
<div class="nav-page-selector" id="navPageSelector">
    <button class="nav-page-trigger" onclick="toggleNavDropdown()">
        <span class="current-page-name">
            {% if 'simulator' in request.url.path %}Simulator
            {% elif 'spending-editor' in request.url.path %}Spending Plan
            {% else %}Overview{% endif %}
        </span>
        <svg class="chevron-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
            <polyline points="6 9 12 15 18 9"></polyline>
        </svg>
    </button>
    
    <div class="nav-dropdown-menu">
        <a href="/" class="nav-dropdown-item {% if request.url.path == '/' %}active{% endif %}">
            Overview <span class="check">✓</span>
        </a>
        <a href="/simulator" class="nav-dropdown-item {% if 'simulator' in request.url.path %}active{% endif %}">
            Simulator <span class="check">✓</span>
        </a>
        <a href="/spending-editor" class="nav-dropdown-item {% if 'spending-editor' in request.url.path %}active{% endif %}">
            Spending Plan <span class="check">✓</span>
        </a>
    </div>
</div>
{% endmacro %}

{# Page Header #}
{% macro page_header(title, subtitle, actions=None) %}
<header class="app-header">
    <div class="header-brand">
        <div style="display: flex; align-items: center; gap: 1rem;">
            <h1>{{ title }}</h1>
            {{ nav_dropdown() }}
        </div>
        {% if subtitle and subtitle.strip() %}<p class="tagline">{{ subtitle }}</p>{% endif %}
    </div>
    <div class="header-controls">
        <!-- Actions if any -->
    </div>
</header>
{% endmacro %}

{# Dashboard Header #}
{% macro dashboard_header(level_text=None, level_badge_class="badge-primary", tagline="", extra_classes="", tagline_style="", adjust_label="Adjust Spending", adjust_icon="edit") %}
<header class="app-header app-header-balanced {{ extra_classes }}">
    <div class="header-brand">
        <h1>
            Radiant 
        </h1>
        {{ nav_dropdown() }}
        {% if tagline and tagline.strip() %}<p class="tagline" style="{{ tagline_style }}">{{ tagline }}</p>{% endif %}
    </div>
    
    <div class="header-center">
        {% if level_text %}
        <button class="level-pill {{ level_badge_class }}" onclick="document.getElementById('level-modal').showModal()">
            {{ level_text }}
        </button>
        {% endif %}
    </div>

    <div class="header-controls">
        <!-- Placeholder for right aligned controls if any -->
    </div>
</header>

{# Levels Modal #}
<dialog id="level-modal" class="modal wealth-modal">
    <div class="modal-content">
        <div class="modal-header">
            <div class="header-title">
                <h2>Wealth Levels</h2>
                <p class="subtitle">Your journey to financial freedom</p>
            </div>
            <button onclick="document.getElementById('level-modal').close()" class="close-btn">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
            </button>
        </div>
        
        <div class="wealth-ladder">
            <!-- Level 5 -->
            <div class="ladder-step {% if 'Level 5' in level_text|default('') %}active{% endif %}" data-level="5">
                <div class="step-marker">
                    <div class="marker-node">5</div>
                    <div class="marker-line"></div>
                </div>
                <div class="step-content">
                    <div class="step-header">
                        <h3>Abundance</h3>
                        <span class="step-tag">Legacy</span>
                    </div>
                    <p>Wealth works for you. Focus on impact, philanthropy, and generational growth.</p>
                </div>
            </div>

            <!-- Level 4 -->
            <div class="ladder-step {% if 'Level 4' in level_text|default('') %}active{% endif %}" data-level="4">
                <div class="step-marker">
                    <div class="marker-node">4</div>
                    <div class="marker-line"></div>
                </div>
                <div class="step-content">
                    <div class="step-header">
                        <h3>Growth</h3>
                        <span class="step-tag">Expansion</span>
                    </div>
                    <p>Diversifying income streams and optimizing for tax efficiency and scale.</p>
                </div>
            </div>

            <!-- Level 3 -->
            <div class="ladder-step {% if 'Level 3' in level_text|default('') %}active{% endif %}" data-level="3">
                <div class="step-marker">
                    <div class="marker-node">3</div>
                    <div class="marker-line"></div>
                </div>
                <div class="step-content">
                    <div class="step-header">
                        <h3>Accumulation</h3>
                        <span class="step-tag">Compounding</span>
                    </div>
                    <p>Investing in assets that grow over time. Your money starts making money.</p>
                </div>
            </div>

            <!-- Level 2 -->
            <div class="ladder-step {% if 'Level 2' in level_text|default('') %}active{% endif %}" data-level="2">
                <div class="step-marker">
                    <div class="marker-node">2</div>
                    <div class="marker-line"></div>
                </div>
                <div class="step-content">
                    <div class="step-header">
                        <h3>Stability</h3>
                        <span class="step-tag">Security</span>
                    </div>
                    <p>Building the fortress. High-interest debt is gone; emergency fund is funded.</p>
                </div>
            </div>

            <!-- Level 1 -->
            <div class="ladder-step {% if 'Level 1' in level_text|default('') %}active{% endif %}" data-level="1">
                <div class="step-marker">
                    <div class="marker-node">1</div>
                </div>
                <div class="step-content">
                    <div class="step-header">
                        <h3>Clarity</h3>
                        <span class="step-tag">Foundation</span>
                    </div>
                    <p>Understanding the flow. Tracking income and expenses to stop the bleed.</p>
                </div>
            </div>
        </div>
    </div>
</dialog>
{% endmacro %}
