{% extends "templates/layouts/base.html" %}
{% from "templates/components/atoms.html" import button, icon %}
{% from "templates/components/molecules.html" import card, stat, kpi_box, alert, dashboard_header %}

{% block title %}Radiant - Overview{% endblock %}

{% block extra_js %}
<script type="module" src="/static/js/modules/main.js"></script>
{% endblock %}

{% block content %}
    {% set level_text = "Level " ~ user.current_level if user else "Level 0" %}
    {% call dashboard_header(level_text, "badge badge-danger", "Crisis Mode: Stop the bleeding.", "", "", "Cut Expenses", "list") %}
        <!-- No extra actions for Level 0, focus on fixing cash flow -->
    {% endcall %}

    <div id="loading">Analyzing cash flow...</div>

    <div id="dashboard" class="hidden">
        <!-- Level 0 Focus: Cash Flow & Burn -->
        <div class="dashboard-overview">
            {% call card("Immediate Action Needed", "alert-triangle") %}
                <div class="stat">
                    <div class="stat-label">
                        <span class="term" data-tooltip="Income minus Expenses. Must be positive.">Net Cash Flow</span>
                    </div>
                    <div class="stat-value text-danger" id="savings-rate">--</div> 
                    <div class="stat-change negative">You are burning cash</div>
                </div>
                <div class="separator"></div>
                {{ alert("Insolvency Detected", "Your expenses exceed your income. Use the Spending Plan to cut 'Wants' immediately.", "danger") }}
            {% endcall %}

            {% call card("Burn Rate Analysis", "activity") %}
                <div class="kpi-row">
                     {{ kpi_box("Monthly Burn", id="monthly-burn") }}
                     {{ kpi_box("Runway (Months)", id="runway-months") }}
                </div>
            {% endcall %}
        </div>

        <!-- Only show essentials -->
        <div class="grid">
             {% call card("Expense Breakdown", "pie-chart") %}
                <div class="chart-container" id="chart-spending"></div>
                <div class="reasoning">
                    Identify the largest categories to cut.
                </div>
            {% endcall %}
        </div>
    </div>
{% endblock %}
